 <div class="app-container">
      <header class="app-header">
        <div class="header-content">
          <div class="logo-section">
            <div class="logo" aria-hidden="true">
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                <rect width="32" height="32" rx="8" fill="url(#logo-gradient)" />
                <path d="M10 12h12M10 16h8M10 20h10" stroke="white" stroke-width="2" stroke-linecap="round" />
                <circle cx="24" cy="12" r="2" fill="#fbbf24" />
                <defs>
                  <linearGradient id="logo-gradient" x1="0" y1="0" x2="32" y2="32">
                    <stop stop-color="#6366f1" />
                    <stop offset="1" stop-color="#8b5cf6" />
                  </linearGradient>
                </defs>
              </svg>
            </div>
            <div class="title-section">
              <h1 class="app-title">UI Debugger</h1>
              <span class="app-subtitle">Powered by Gemini AI</span>
            </div>
          </div>
          <button
            class="settings-button"
            [attr.aria-label]="gemini.isConfigured() ? 'API key configured. Click to change' : 'Configure API key'"
            (click)="showApiKeyModal.set(true)"
          >
            @if (gemini.isConfigured()) {
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
              </svg>
              <span>API Ready</span>
            } @else {
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4" />
              </svg>
              <span>Add API Key</span>
            }
          </button>
        </div>
      </header>

      <main class="app-main">
        @if (!currentImage()) {
          <section class="upload-section" aria-label="Upload screenshot">
            <app-image-upload (imageSelected)="onImageSelected($event)" />
            
            <div class="features-grid" aria-label="Features">
              <div class="feature-card">
                <div class="feature-icon layout" aria-hidden="true">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" />
                    <line x1="9" y1="3" x2="9" y2="21" />
                    <line x1="3" y1="9" x2="21" y2="9" />
                  </svg>
                </div>
                <h3 class="feature-title">Layout Issues</h3>
                <p class="feature-desc">Detects alignment, spacing, and responsive problems</p>
              </div>
              <div class="feature-card">
                <div class="feature-icon a11y" aria-hidden="true">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10" />
                    <path d="M12 8v4l3 3" />
                  </svg>
                </div>
                <h3 class="feature-title">Accessibility</h3>
                <p class="feature-desc">Finds contrast, ARIA, and usability concerns</p>
              </div>
              <div class="feature-card">
                <div class="feature-icon design" aria-hidden="true">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 19l7-7 3 3-7 7-3-3z" />
                    <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z" />
                    <path d="M2 2l7.586 7.586" />
                    <circle cx="11" cy="11" r="2" />
                  </svg>
                </div>
                <h3 class="feature-title">Design QA</h3>
                <p class="feature-desc">Spots typography, color, and visual hierarchy issues</p>
              </div>
              <div class="feature-card">
                <div class="feature-icon code" aria-hidden="true">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="16 18 22 12 16 6" />
                    <polyline points="8 6 2 12 8 18" />
                  </svg>
                </div>
                <h3 class="feature-title">Code Fixes</h3>
                <p class="feature-desc">Generates HTML, CSS, and Angular patches</p>
              </div>
            </div>
          </section>
        } @else {
          <div class="analysis-layout">
            <section class="image-section" aria-label="Screenshot with annotations">
              @if (gemini.isAnalyzing()) {
                <app-loading-spinner />
              } @else if (analysisResult()) {
                <app-annotated-image
                  [imageUrl]="currentImage()!"
                  [issues]="analysisResult()!.issues"
                  [selectedIssueId]="selectedIssueId()"
                  (issueSelected)="selectedIssueId.set($event)"
                />
              } @else {
                <img [src]="currentImage()" alt="Uploaded screenshot" class="preview-only" />
              }

              <div class="image-actions">
                <button class="action-button secondary" (click)="resetAnalysis()">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                    <path d="M3 3v5h5" />
                  </svg>
                  New Screenshot
                </button>
                @if (!gemini.isAnalyzing() && !analysisResult()) {
                  <button
                    class="action-button primary"
                    [disabled]="!gemini.isConfigured()"
                    (click)="analyzeImage()"
                  >
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <circle cx="11" cy="11" r="8" />
                      <line x1="21" y1="21" x2="16.65" y2="16.65" />
                    </svg>
                    Analyze UI
                  </button>
                }
              </div>
            </section>

            <aside class="issues-section" aria-label="Detected issues">
              @if (analysisResult()) {
                <app-score-display
                  [score]="analysisResult()!.overallScore"
                  [summary]="analysisResult()!.summary"
                />

                <div class="issues-header">
                  <h2 class="issues-title">Issues Found</h2>
                  <div class="filter-pills" role="group" aria-label="Filter issues by severity">
                    <button
                      class="filter-pill"
                      [class.active]="issueFilter() === 'all'"
                      [attr.aria-pressed]="issueFilter() === 'all'"
                      (click)="issueFilter.set('all')"
                    >
                      All ({{ analysisResult()!.issues.length }})
                    </button>
                    <button
                      class="filter-pill critical"
                      [class.active]="issueFilter() === 'critical'"
                      [attr.aria-pressed]="issueFilter() === 'critical'"
                      (click)="issueFilter.set('critical')"
                    >
                      Critical ({{ criticalCount() }})
                    </button>
                    <button
                      class="filter-pill warning"
                      [class.active]="issueFilter() === 'warning'"
                      [attr.aria-pressed]="issueFilter() === 'warning'"
                      (click)="issueFilter.set('warning')"
                    >
                      Warning ({{ warningCount() }})
                    </button>
                  </div>
                </div>

                <div class="issues-list" role="list">
                  @for (issue of filteredIssues(); track issue.id) {
                    <app-issue-panel
                      [issue]="issue"
                      [isSelected]="selectedIssueId() === issue.id"
                      (toggleClick)="toggleIssue(issue.id)"
                    />
                  } @empty {
                    <p class="no-issues">No issues match the selected filter.</p>
                  }
                </div>
              } @else if (!gemini.isAnalyzing()) {
                <div class="empty-state">
                  <div class="empty-icon" aria-hidden="true">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                      <circle cx="11" cy="11" r="8" />
                      <line x1="21" y1="21" x2="16.65" y2="16.65" />
                    </svg>
                  </div>
                  <h3 class="empty-title">Ready to Analyze</h3>
                  <p class="empty-desc">
                    @if (gemini.isConfigured()) {
                      Click "Analyze UI" to detect issues in your screenshot.
                    } @else {
                      Add your Gemini API key to start analyzing.
                    }
                  </p>
                </div>
              }
            </aside>
          </div>
        }

        @if (gemini.error()) {
          <div class="error-toast" role="alert">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
            </svg>
            <span>{{ gemini.error() }}</span>
            <button class="dismiss-error" aria-label="Dismiss error" (click)="dismissError()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />
              </svg>
            </button>
          </div>
        }
      </main>

      @if (showApiKeyModal()) {
        <app-api-key-modal
          (apiKeySubmit)="onApiKeySubmit($event)"
          (close)="showApiKeyModal.set(false)"
        />
      }
    </div>